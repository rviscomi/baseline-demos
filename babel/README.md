# Baseline demo: Babel

The source code for this demo is [src/test.js](src/test.js), which contains several examples of modern JavaScript code.

The goal of the demo is to see how the output code is affected by different [.browserslistrc](.browserslistrc) configurations:

- the default config (discouraged)
- a pseudo-Baseline config
- a proper Baseline config generated by bl2bl

## Setup

1. From this directory run `npm i`

## Default browserslist config (discouraged)

Babel recommends setting target versions in the Babel or browserslist configurations to reduce output size. Without one, the default behavior is to fall back to ES5:

> When no targets are specified: Babel will assume you are targeting the oldest browsers possible. For example, @babel/preset-env will transform all ES2015-ES2020 code to be ES5 compatible.

To test this:

1. Open [.browserslistrc](.browserslistrc) and ensure that the config is empty
2. Run `npm run build`
3. Open [lib/test.js](lib/test.js) to see the output

The output will be stripped of all newer JavaScript syntax, for example arrow functions will be replaced with function expressions and `const` replaced with `var`:

```js
const add = (a, b) => a + b;
```

becomes:

```js
var add = function add(a, b) {
  return a + b;
};
```

File | Size (KB)
-- | --
src/test.js | 0.9
lib/test.js | 2.6

## Pseudo-Baseline config

The browserslist config allows rules that will get you most of the way to Baseline Widely available:

1. Open [.browserslistrc](.browserslistrc)
2. Replace the contents with

    ```
    chrome >0 and last 2.5 years
    edge >0 and last 2.5 years
    safari >0 and last 2.5 years
    firefox >0 and last 2.5 years
    and_chr >0 and last 2.5 years
    and_ff >0 and last 2.5 years
    ios >0 and last 2.5 years
    ```
3. Run `npm run build`
4. Open [lib/test.js](lib/test.js) to see the output

The output file should now contain the modern JavaScript with minimal transformations.

File | Size (KB)
-- | --
src/test.js | 0.9
lib/test.js | 1.0

> [!NOTE]
> This browserlist config was first suggested by [Philip Walton](https://philipwalton.com/articles/the-state-of-es5-on-the-web/#recommendations)
>
> It's called a pseudo-Baseline config for a couple of reasons:
> - it doesn't use the Baseline semantics of "Widely available"
> - it omits the earliest browser version available at the time 2.5 years ago
>
> To confirm the second issue, run `npx browserslist` and note the earliest Chrome version, eg Chrome 105. Its release date will always be after today's date 2.5 years ago.
>
> The next config addresses these limitations.

## Baseline Widely available (bl2bl)

If you followed the [setup](#setup) steps, you will have installed the [bl2bl](https://github.com/tonypconway/bl2bl) helper module, which lets you use Baseline semantics like "Widely available" and turn that into the corresponding browserslist config. To use it:

1. Run `npx bl2bl` to set the browserslist config to Baseline Widely available, which is specified in [package.json](package.json)
2. Run `npm run build`
3. Open [lib/test.js](lib/test.js) to see the output

As before, the output file should still contain the modern JavaScript with minimal transformations.

File | Size (KB)
-- | --
src/test.js | 0.9
lib/test.js | 1.0

You can also inspect the updated [.browserslistrc](.browserslistrc) config, which should look something like this:

```
# This file was created by bl2bl2. 
# Learn more at https://github.com/tonypconway/bl2bl
Chrome >= 104
ChromeAndroid >= 104
Edge >= 104
Firefox >= 103
FirefoxAndroid >= 103
Safari >= 15
iOS >= 15
Opera >= 90
op_mob >= 71
Samsung >= 20.0
Android >= 104
and_qq >= 14.2
```

_(Exact browser versions will depend on when you ran the command.)_

Note that the earlest Chrome version will be 1 version older than the one in the previous config, eg Chrome 104.
