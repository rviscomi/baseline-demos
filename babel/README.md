# Baseline demo: Babel

The source code for this demo is [src/test.js](src/test.js), which contains several examples of modern JavaScript code.

The goal of the demo is to see how the output code is affected by different [.browserslistrc](.browserslistrc) configurations:

- the default config (discouraged)
- a pseudo-Baseline config
- a proper Baseline config generated by bl2bl

## Setup

1. From this directory run `npm i`

## Default browserslist config (discouraged)

Babel recommends setting target versions in the Babel or browserslist configurations to reduce output size. Without one, the default behavior is to fall back to ES5:

> When no targets are specified: Babel will assume you are targeting the oldest browsers possible. For example, @babel/preset-env will transform all ES2015-ES2020 code to be ES5 compatible.

To test this:

1. Open [.browserslistrc](.browserslistrc) and ensure that the config is empty
2. Run `npm run build`
3. Open [lib/test.js](lib/test.js) to see the output

The output will be stripped of all newer JavaScript syntax, for example arrow functions will be replaced with function expressions and `const` replaced with `var`:

```js
const add = (a, b) => a + b;
```

becomes:

```js
var add = function add(a, b) {
  return a + b;
};
```

File | Size (KB)
-- | --
src/test.js | 1.3
lib/test.js | 13.2

## Pseudo-Baseline config

The browserslist config allows rules that will get you most of the way to Baseline Widely available:

1. Open [.browserslistrc](.browserslistrc)
2. Replace the contents with

    ```
    chrome >0 and last 2.5 years
    edge >0 and last 2.5 years
    safari >0 and last 2.5 years
    firefox >0 and last 2.5 years
    and_chr >0 and last 2.5 years
    and_ff >0 and last 2.5 years
    ios >0 and last 2.5 years
    ```
3. Run `npx browserslist` to see the browser versions included in the browserslist config
4. Run `npm run build`
5. Open [lib/test.js](lib/test.js) to see the output

The output file should now contain the modern JavaScript with minimal transformations.

File | Size (KB)
-- | --
src/test.js | 1.3
lib/test.js | 1.4

> [!NOTE]
> This browserlist config was first suggested by [Philip Walton](https://philipwalton.com/articles/the-state-of-es5-on-the-web/#recommendations)
>
> It's called a pseudo-Baseline config for a couple of reasons:
> - it doesn't use the Baseline semantics of "Widely available"
> - it omits the earliest browser version available at the time 2.5 years ago
>
> To confirm the second issue, run `npx browserslist` and note the earliest Chrome version, eg Chrome 105. Its release date will always be after today's date 2.5 years ago.

## `browserslist-config-baseline` default

The default configuration of the [`browserslist-config-baseline`](https://github.com/web-platform-dx/browserslist-config-baseline) plugin is identical to the pseudo-Baseline config above. To use it:

1. Open [.browserslistrc](.browserslistrc)
2. Replace the contents with

  ```
  extends browserslist-config-baseline/
  ```
3. Run `npx browserslist` to see the browser versions included in the browserslist config
4. Run `npm run build`
5. Open [lib/test.js](lib/test.js) to see the output

File | Size (KB)
-- | --
src/test.js | 1.3
lib/test.js | 1.4

## `browserslist-config-baseline` Baseline year

1. Open [.browserslistrc](.browserslistrc)
2. Replace the contents with

  ```
  extends browserslist-config-baseline/2020
  ```
3. Run `npx browserslist` to see the browser versions included in the browserslist config
4. Run `npm run build`
5. Open [lib/test.js](lib/test.js) to see the output

File | Size (KB)
-- | --
src/test.js | 1.3
lib/test.js | 1.5

## `browserslist-config-baseline` Baseline year with downstream browsers

1. Open [.browserslistrc](.browserslistrc)
2. Replace the contents with

  ```
  extends browserslist-config-baseline/with-downstream/2020
  ```
3. Run `npx browserslist` to see the browser versions included in the browserslist config
4. Run `npm run build`
5. Open [lib/test.js](lib/test.js) to see the output

File | Size (KB)
-- | --
src/test.js | 1.3
lib/test.js | 1.5

## Baseline Widely available

1. Open [.browserslistrc](.browserslistrc)
2. Replace the contents with

  ```
  extends browserslist-config-baseline
  ```
3. Run `npx browserslist` to see the browser versions included in the browserslist config
4. Run `npm run build`
5. Open [lib/test.js](lib/test.js) to see the output

File | Size (KB)
-- | --
src/test.js | 1.3
lib/test.js | 1.4

## Baseline Widely available with downstream browsers

1. Open [.browserslistrc](.browserslistrc)
2. Replace the contents with

  ```
  extends browserslist-config-baseline/with-downstream
  ```
3. Run `npx browserslist` to see the browser versions included in the browserslist config
4. Run `npm run build`
5. Open [lib/test.js](lib/test.js) to see the output

File | Size (KB)
-- | --
src/test.js | 1.3
lib/test.js | 1.4
